<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>舞台の灯 - はじまり</title>
  <style>
    body {
      background: #191716 url('https://www.transparenttextures.com/patterns/old-wall.png');
      color: #e2d3bb;
      font-family: 'Noto Serif JP', serif;
      margin: 0;
      text-align: center;
      min-height: 100vh;
      position: relative;
      box-shadow: inset 0 0 160px #6c5740, inset 0 50vh 100px -60px #392c20;
      /* くすみや黄ばみも */
      filter: sepia(0.25) contrast(0.9) brightness(0.95);
      overflow: hidden;
    }
    .center {
      max-width: 420px;
      margin: 9em auto;
      background:
        linear-gradient(170deg, #39301e 0%, #231e18 80%, #1b1611 100%);
      padding: 2.8em 2em 2.1em;
      border-radius: 1.3em 0.9em 1.8em 1.2em/1.5em 1.7em 2.3em 1.2em;
      border: 2.3px solid #b79b6677;
      box-shadow:
        0 0 0 8px #846d4b12,
        0 5px 72px 0px #31231cbb,
        0 0 0 71px rgba(87,63,40,0.24) inset,
        0 0 150px 50px rgba(40,30,9,0.22) inset;
      /* 破れ風角部分 */
      clip-path: polygon(
        0 0, 
        100% 0%, 
        100% 96%, 
        96% 100%, 88% 97%, 
        78% 100%, 70% 95%,
        62% 98%, 56% 95%, 48% 100%, 
        38% 97%, 31% 100%, 21% 93%, 0 100%);
      position: relative;
      filter: grayscale(0.18) sepia(0.17) brightness(0.90);
      animation: fadein 2.5s cubic-bezier(0.18,0.9,0.5,1.47) both;
    }
    @keyframes fadein {
      from { opacity:0; filter:blur(30px);}
      to   { opacity:1; filter:none;}
    }
    h1 {
      color: #b59854;
      font-size: 2.1em;
      margin-bottom: .5em;
      text-shadow:0 4px 11px #47370b40, 1px 1px 0 #665;
      letter-spacing: .09em;
      font-family: 'Noto Serif JP', serif;
      font-weight: bold;
      /* ヒビ演出 */
      position: relative;
    }
    h1::after {
      content: ""; display: block;
      width: 80px; height: 1px;
      margin: 0.55em auto 0 auto;
      background: repeating-linear-gradient(90deg, #84703d, #c1a666 8px, transparent 11px, transparent 18px);
      opacity: 0.47;
      filter: blur(0.6px);
    }
    .note {
      color: #d2be91;
      font-size: 1.14em;
      margin-bottom: 2em;
      line-height: 1.84;
      text-shadow: 0 1px 0 #2d210b55, 0 0 15px #4d3c2055;
      letter-spacing: 0.07em;
      text-align: center;
      -webkit-mask-image: linear-gradient(180deg, #0008 88%,transparent 100%);
      mask-image: linear-gradient(180deg, #0008 88%,transparent 100%);
      position: relative;
    }
    .note:after {
      content:"";
      display:block;
      position:absolute;
      left:22%; bottom:-9px; width:56%; height:8px;
      background: linear-gradient(90deg, #483a22 11%, transparent 97%);
      opacity: 0.5;
      pointer-events:none;
      border-radius: 26px;
      z-index:0;
    }
    button {
      background: linear-gradient(175deg, #9c8b49 0%, #493f14 98%);
      color: #eee1ab;
      font-size:1.35em;
      border:none;
      border-radius:10px 24px 12px 7px/19px 14px 17px 11px;
      padding: .7em 2.5em;
      box-shadow: 0 2px 12px #0004, 0 0 0 2.5px #cfb16c88 inset;
      margin-top:2em;
      font-family: inherit;
      letter-spacing:.12em;
      font-weight: bold;
      user-select: none;
      transition: background 0.22s, color 0.19s, transform 0.13s;
      filter: grayscale(0.12) sepia(0.23);
      position: relative;
    }
    button:active {
      background: linear-gradient(174deg,#c7b16a 0%, #9e8542 90%);
      color: #42310b;
      transform: scale(0.97) translateY(1.2px);
    }
    #msg {
      margin-top:1.3em;
      color:#eeb2a0;
      letter-spacing:.03em;
      text-shadow:1px 1px 0 #23181499;
      font-size:1em;
    }

    /* 汚れ/ヒビの飾り */
    .grunge-corner {
      position: absolute;
      width: 65px; height: 52px;
      background:
        radial-gradient(ellipse 55% 25% at 80% 15%, #5d4625cc 40%, transparent 100%),
        repeating-linear-gradient(-24deg, #bca4770c 0 9px, transparent 13px 23px),
        radial-gradient(ellipse 40% 45% at 9% 83%, #96815455 40%, transparent 95%),
        radial-gradient(circle at 60% 72%, #89561e33 6%, transparent 60%);
      opacity: 0.40;
      pointer-events:none;
      z-index: 5;
    }
    .grunge-corner.cc1 { left: 0; top: 0;}
    .grunge-corner.cc2 { right: 0; top: 0; transform: scaleX(-1);}
    .grunge-corner.cc3 { left: 0; bottom: 0;}
    .grunge-corner.cc4 { right: 0; bottom: 0; transform: scaleX(-1);}
    /* 細かい埃や紙片 */
    .tears {
      position:absolute;
      left:12%; top:86.5%;
      width: 30px; height: 21px;
      background: 
        conic-gradient(from 20deg at 32% 84%, #e6dec933 3%, #ab986666 12%, #2f2318cc 84%, transparent 100%);
      opacity:0.33; z-index: 10;
      pointer-events: none;
      filter: blur(0.3px);
    }
    @media (max-width:700px){
      .center {
        margin: 6.3em 5vw;
        padding:2.3em 5vw 2.1em 5vw;
        min-width: unset;
      }
    }
  </style>
</head>
<body>
  <div class="center">
    <div class="grunge-corner cc1"></div>
    <div class="grunge-corner cc2"></div>
    <div class="grunge-corner cc3"></div>
    <div class="grunge-corner cc4"></div>
    <div class="tears"></div>
    <h1>舞台の灯</h1>
    <div class="note">
      かつての光を失った劇場。<br>
      <b style="color:#a88; text-shadow:0 0 6px #250;">だが今宵、三つの灯が集い、</b><br>
      再び舞台に命が吹きこまれる。
    </div>
    <button id="btn">物語を始める</button>
    <div id="msg"></div>
  </div>
  <script>
    const GAS = 'https://script.google.com/macros/s/AKfycbxOhXaHg2WVUpuKDwUjCl4UwuqObFgZzH38MWyOi49lHvg4Pdhw_RlXWhZatpcTSNd8Tw/exec';
    document.getElementById('btn').onclick = async ()=>{
      document.getElementById('msg').textContent = "舞台の準備中・・・";
      let resp = await fetch(GAS+"?cmd=newRoom");
      let data = await resp.json();
      if(data && data.roomID && data.userID){
        sessionStorage.setItem("roomID", data.roomID);
        sessionStorage.setItem("userID", data.userID);
        sessionStorage.setItem("role", data.role);
        location.href = "representative.html";
      } else {
        document.getElementById('msg').textContent = "通信エラー。少し待って再度お試しください。";
      }
    }
  </script>
</body>
</html>
