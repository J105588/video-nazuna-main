<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>舞台の灯 - 代表の灯</title>
  <style>
    body{ background:#22201b; color:#f7debe; text-align:center; font-family:'Noto Serif JP', serif;}
    .frame{ margin:6em auto 0; max-width:400px;padding:2em 1.5em; background:#2c251e; border-radius:1em;}
    h2 { color:gold; }
    #qrcode { margin:2em auto 1.6em; }
  </style>
</head>
<body>
  <div class="frame">
    <h2>代表となりました</h2>
    <div>このQRを掲げることで<br>仲間たちを舞台の灯へ導きます。</div>
    <canvas id="qrcode" width="240" height="240"></canvas>
    <div style="font-size:.95em;margin-top:1.4em;color: #f99;">※参加者に物理的にこのコードを読み取ってもらってください。</div>
    <div id="status"></div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script>
    // 自分のroomID, userIDをQRに埋め込む
    const roomID = sessionStorage.getItem("roomID");
    const userID = sessionStorage.getItem("userID");
    const QRVAL = `roomID:${roomID};leader:${userID}`;
    QRCode.toCanvas(document.getElementById('qrcode'), QRVAL, { width: 240 });
    
    // 進行チェック: 2名がスキャンでreadyなら次へ
    const GAS = 'https://script.google.com/macros/s/AKfycbxOhXaHg2WVUpuKDwUjCl4UwuqObFgZzH38MWyOi49lHvg4Pdhw_RlXWhZatpcTSNd8Tw/exec';
    function poll() {
      fetch(GAS+`?cmd=status&roomID=${roomID}`)
      .then(resp=>resp.json())
      .then(data=>{
        if(data.ready){ location.href="restore.html"; }
        else document.getElementById('status').textContent = `集合状況：${data.scannedCount||0}/2`;
      });
    }
    setInterval(poll, 1800);
    poll();
  </script>
</body>
</html>
